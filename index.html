<!DOCTYPE html>
<html>

<head>
  <title>KedamaMC Unofficial Map</title>
  <style>
  html, body { margin: 0; padding: 0; width: 100%; height: 100%; }
  h4 { margin: 10px; line-height: 1; position: fixed; top: 0; left: 0; width: 100%; text-align: center; text-shadow: 0 0 6px #000; color: #fff; z-index: 1; }
  h4 em { font-weight: normal; font-style: normal; line-height: 2; font-size: 13px; }
  </style>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA_FrfIceV_JYILsYCShrVo50r3HE7yvBw&sensor=false"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script>
  var markerArray = [];
  var map = null;
  var markerVisibility = true;

  // functions to add, hide, and delete markers

  function addMarker(x, y, icon, title) {
    var marker = new google.maps.Marker({
      position: new google.maps.LatLng((y + .5) / 256, (x + .5) / 256),
      map: map,
      icon: icon,
      title: title + "\n(" + x + ", " + y + ")"
    });
    markerArray.push(marker);
  }

  function toggleAllMarkers() {
    markerVisibility = !markerVisibility;
    for (i in markerArray) {
      markerArray[i].setVisible(markerVisibility);
    }
  }

  function deleteAllMarkers() {
    for (i in markerArray) {
      markerArray[i].setMap(null);
    }
    markerArray.length = 0;
  }

  // custom projection
  // lat range is [-4,4] corresponding to y [-512,512] in the zoom level 0 image set
  // lng range is [-4,4] corresponding to x [-512,512] in the zoom level 0 image set
  // in terms of game coordinates:
  //   inGameX = lng * 1024
  //   inGameZ = lat * 1024

  function ProjectionCartesian() {};

  // this is surely off as I am using images of size 256 and not 512.  someone smarter than me figure it out
  ProjectionCartesian.prototype.fromLatLngToPoint = function(latLng) {
    return new google.maps.Point(latLng.lng() * 512 / 32, latLng.lat() * 512 / 32);
  };

  ProjectionCartesian.prototype.fromPointToLatLng = function(point, noWrap) {
    return new google.maps.LatLng(point.y / 512 * 32, point.x / 512 * 32, noWrap);
  };

  // icon definitions for markers

  var iconSpawn = {
    path: google.maps.SymbolPath.CIRCLE,
    fillColor: "red",
    fillOpacity: 1.0,
    scale: 4,
    strokeColor: "black",
    strokeWeight: 1
  };

  var iconPortal = {
    path: 'M -1,-1 1,-1 1,1 -1,1 z',
    fillColor: "purple",
    fillOpacity: 1.0,
    scale: 4,
    strokeColor: "black",
    strokeWeight: 1
  };

  // the initialization function, called when the page body loads

  function initialize() {
    var mapOptions = {
      center: new google.maps.LatLng(0, 0),
      zoom: 4,
      streetViewControl: false,
      zoomControl: true,
      panControl: false,
      scaleControl: false,
      mapTypeControlOptions: {
        mapTypeIds: ['overworld']
      }
    };

    map = new google.maps.Map(document.getElementById('map_canvas'), mapOptions);

    // can define multiple mapTypes (similar to how standard google maps has satellite, map, hybrid).
    var mapTypeOverworld = new google.maps.ImageMapType({
      getTileUrl: function(coord, zoom) {
        var z = Math.pow(2, zoom - 4);
        return 'Overworld/images/z' + z + '/' + coord.x + ',' + coord.y + '.png';
      },
      tileSize: new google.maps.Size(256, 256), // size of image.  their native size to display 1 to 1
      maxZoom: 7,
      minZoom: 0,
      name: 'Overworld'
    });

    // use the custom latitude and logitude projection
    mapTypeOverworld.projection = new ProjectionCartesian();

    // add the map type to the map
    map.mapTypes.set('overworld', mapTypeOverworld);
    map.setMapTypeId('overworld');

    // listener for clicks on the map surface
    google.maps.event.addListener(map, 'rightclick', function(event) {
      toggleAllMarkers();
    });

    // add markers
    addMarker(2, 11, iconSpawn, '世界出生点');
    addMarker(411, -109, iconSpawn, '奶油芒果蛋糕');
    addMarker(250, -64, iconSpawn, 'Fly_Goat的小屋');
    addMarker(216, 24, iconSpawn, 'EJQ\'s');
    addMarker(111, 8, iconSpawn, '251起飞台');
    addMarker(110, 34, iconSpawn, 'BlockTacker\'s');
    addMarker(217, 184, iconSpawn, 'Black_TeaAnna\'s');
    addMarker(376, -541, iconSpawn, 'EdwardWLH\'s');
    addMarker(369, -631, iconSpawn, 'Mynaemechengguan\'s');
    addMarker(299, -657, iconSpawn, '圣诞树');
    addMarker(-3, -705, iconSpawn, 'iPlayForKidYou\'s');
    addMarker(-412, 207, iconSpawn, 'JieXia\'s');
    addMarker(-645, 219, iconSpawn, '死亡天坑');
    addMarker(17, 183, iconSpawn, '冰帝宫');
    addMarker(-91, 258, iconSpawn, 'loaring\'s');
    addMarker(-304, 431, iconSpawn, '山体峡谷的裂口');
    addMarker(-308, 507, iconSpawn, 'Mr_Sachen\'s');
    addMarker(-138, 541, iconSpawn, '羊驼神社');
    addMarker(-1, -89, iconSpawn, '大圣诞树');
    addMarker(-897, 854, iconSpawn, 'Ghastty\'s');
    addMarker(388, 212, iconSpawn, 'chrgs\'');
    addMarker(591, 359, iconSpawn, 'EOH_JueQing\'s');
    addMarker(642, 548, iconSpawn, '荒村');
    addMarker(785, 606, iconSpawn, 'WitheringNight\'s');
    addMarker(869, 366, iconSpawn, 'nihui\'s?');
  }
  </script>
</head>

<body onload="initialize()">
  <h4>毛玉線圈物語 Sunshine (v2) 主世界非官方地图<br><em>点击右键显示/隐藏标注</em></h4>
  <div id="map_canvas" style="background-color:#000000; width: 100%; height: 100%;"></div>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-82103573-1', 'auto');
    ga('send', 'pageview');
  </script>
</body>

</html>
